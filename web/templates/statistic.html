{% extends "base.html" %}

{% block title_css %}
<title>CMX</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bitcount+Grid+Single:wght@400&display=swap" />
<link rel="stylesheet" href="/static/css/statistic.css" />
{% endblock title_css %}

{% block main %}
<main>
    <div class="statistic-container">
        <div class="soon">Statistic will be available soon, but now you can get trade graph.</div>
        <br>
        <button id="sendChartBtn" class="save-button">get graph</button>
        <p id="statusMessage"></p>
    </div>
</main>

<script>
    document.getElementById('sendChartBtn').addEventListener('click', function() {
        const btn = this;
        const statusMsg = document.getElementById('statusMessage');

        btn.disabled = true;
        statusMsg.textContent = 'Generating and sending chart...';

        fetch('/statistic/send-chart')
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    statusMsg.textContent = 'Success! ' + data.message;
                } else {
                    statusMsg.textContent = 'Error: ' + data.error;
                }
            })
            .catch(error => {
                statusMsg.textContent = 'An unexpected error occurred: ' + error;
            })
            .finally(() => {
                btn.disabled = false;
            });
    });
</script>
{% endblock main %}